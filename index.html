<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä½é™¢ç›¤é»ç³»çµ±</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <!-- React -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 10px 20px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1000;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.connected {
            background: #28a745;
        }

        .status-dot.disconnected {
            background: #dc3545;
            animation: none;
        }

        .status-dot.setup {
            background: #ffc107;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .setup-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }

        .setup-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .setup-content h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .setup-content textarea {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: monospace;
            font-size: 14px;
            margin: 15px 0;
        }

        .section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .section-title {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #667eea;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .online-users {
            font-size: 0.8em;
            color: #28a745;
            font-weight: normal;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #333;
        }

        select, input[type="number"], input[type="month"], input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        select:focus, input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: bold;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        button.secondary {
            background: #6c757d;
        }

        .search-box {
            position: relative;
            margin-bottom: 15px;
        }

        .search-box input {
            padding-right: 40px;
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #999;
        }

        .drug-list {
            max-height: 300px;
            overflow-y: auto;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 10px;
        }

        .drug-item {
            padding: 10px;
            margin: 5px 0;
            background: #f8f9fa;
            border-radius: 5px;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }

        .drug-item:hover {
            background: #e9ecef;
        }

        .drug-item.selected {
            background: #667eea;
            color: white;
        }

        .drug-item.completed {
            background: #d4edda;
            color: #155724;
            cursor: default;
        }

        .drug-item.completed:hover {
            background: #d4edda;
        }

        .drug-item.being-counted {
            background: #fff3cd;
            border: 2px solid #ffc107;
        }

        .counting-badge {
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ffc107;
            color: #000;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            font-weight: bold;
        }

        .info-box {
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #f5c6cb;
        }

        .warning-message {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid #ffeeba;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
        }

        .stat-label {
            font-size: 0.9em;
            margin-top: 5px;
        }

        .current-selection {
            background: #fff3cd;
            border: 1px solid #ffc107;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .recent-activity {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 10px;
            background: #f8f9fa;
        }

        .activity-item {
            padding: 8px;
            border-bottom: 1px solid #ddd;
            font-size: 0.9em;
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-time {
            color: #666;
            font-size: 0.85em;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }

            .section {
                padding: 15px;
            }

            .connection-status {
                top: 10px;
                right: 10px;
                padding: 8px 12px;
                font-size: 0.9em;
            }
        }

        /* åˆ†é æ¨£å¼ */
        .tabs-container {
            background: white;
            border-radius: 15px;
            padding: 0;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .tabs-header {
            display: flex;
            background: #f8f9fa;
            border-bottom: 3px solid #667eea;
        }

        .tab-button {
            flex: 1;
            padding: 20px;
            background: transparent;
            border: none;
            font-size: 1.1em;
            font-weight: bold;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            border-radius: 0;
            position: relative;
        }

        .tab-button:hover {
            background: #e9ecef;
            transform: none;
            box-shadow: none;
        }

        .tab-button.active {
            background: white;
            color: #667eea;
        }

        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            right: 0;
            height: 3px;
            background: #667eea;
        }

        .tab-content {
            padding: 25px;
        }

        .tab-icon {
            font-size: 1.3em;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // åˆå§‹è—¥å“è³‡æ–™
        const initialDrugsData = `è—¥ç¢¼	è—¥å“åç¨±	æ«ƒä½	å¯¦éš›åº«å­˜	è¦æ ¼	å–®ä½
1AKYNZ	Akynzeo	å‰ç½®è—¥		è¤‡æ–¹   	Cap
1AP125	APRETO*é«˜åŠ‘é‡*125mg	å‰ç½®è—¥		125mg  	Cap
25FUNK	5-FU*é«˜1g*å—å…‰	A		20mL   	Vial  
2ABRAX	Abraxane(Nab-Paclitaxel)	B		100mg  	Vial  
2ADC50	Adcetris*é™é™¢æ ¸	å†·A		50mg   	Vial  
2ADREN	Adrenalin0.1%é‡Epinephrineé˜²æ»²	ç„¡æ«ƒä½		1mL    	Amp   
2ADRIA	Adriamycin 10mg Solution	å†·B		5mL    	Vial  
2ALIM0	Alimta 500mg*ä½æ”¶å…¥æˆ¶å…è²»å°ˆæ¡ˆ*	ç„¡æ«ƒä½		500mg  	Vial  
2ALIM1	Alimta*ä½100mg*(Pemetrexed)#	ç„¡æ«ƒä½		100mg  	Vial  
2ALIMT	Alimta*é«˜500mg*(Pemetrexed)#	ç„¡æ«ƒä½		500mg  	Vial  
2ALIQ0	Aliqopa*è´ˆè—¥	ç„¡æ«ƒä½		60mg   	Vial  
2ALIQO	Aliqopa*é™¢æ ¸	ç„¡æ«ƒä½		60mg   	Vial  
2ALOXI	Aloxi	ç„¡æ«ƒä½		5mL    	Vial  
2ASADI	Asadin ç½•è—¥	B		10mL   	Vial  
2ATEZO	TECENTRIQè´ˆè—¥*1.2g*é«˜	ç„¡æ«ƒä½		20mL   	Vial  
2ATRIA	Atriance 250mg*è¡›å°ˆ*è‡ªè²»	ç„¡æ«ƒä½		50mL   	Vial  
2AVAS0	Avastin*è´ˆè—¥*100mg	å†·C		4mL    	Vial  
2AVAS1	Avastin 100mg	å†·A		4mL    	Vial  
2BENDA	Bendamustine	B		100mg  	Vial  
2BESPO	Besponsa*é™¢æ ¸	ç„¡æ«ƒä½		1mg    	Vial  
2BLEOM	Bleomycin 15mg/Vial(Bleocin)	å†·A		15mg   	Vial  
2BLIN0	Blincytoè´ˆè—¥	å†·B		35mcg  	Vial  
2BLINC	Blincyto*é™¢æ ¸	å†·B		35mcg  	Vial  
2BRED 	B-Red   (Vit.B12)  1mg	å‰ç½®è—¥		1mL    	Vial  
2BUSUL	Busulfex é‡60mg/10mL	å†·B		10mL   	Vial  
2CARMU	Carmuther 100(BiCNU)è¡›ç¦éƒ¨å°ˆæ¡ˆ	å†·A		100mg  	Vial  
2COLU0	Columvi 2.5mg*è´ˆè—¥	å†·D		2.5mg  	Vial  
2COLUM	Columvi 10mg*é™¢æ ¸	ç„¡æ«ƒä½		10mg   	
2COVOR	Covorin	ç„¡æ«ƒä½		5mL    	Vial  
2CY500	Cytosar 500mgé‡	B		500mg  	Amp   
2CYR1 	Cyramza*ä½100mg*	ç„¡æ«ƒä½		10mL   	Vial  
2CYR5 	CYRAMZA*é«˜500mg*	ç„¡æ«ƒä½		50mL   	Vial  
2CYRA1	Cyramza*ä½100mg*è´ˆè—¥*DC	ç„¡æ«ƒä½		10mL   	Vial  
2DACAR	Dacarbazine	å†·A		200mg  	Vial  
2DACOG	Dacogen	B		50mg   	Vial  
2DACTI	Dactilon 0.5mg*è¡›å°ˆ*é™¢æ ¸	B		0.5mg  	Vial  
2DARSC	Darzalex*çš®ä¸‹*1800mg*é™¢æ ¸	ç„¡æ«ƒä½		15mL   	Vial  
2DARZ1	Darzalex*ä½*100mg	ç„¡æ«ƒä½		5mL    	Vial  
2DARZ4	DARZALEX*é«˜*400mg	ç„¡æ«ƒä½		20mL   	Vial  
2DAU20	Daunoblastina (Daunorubicin)  	B		20mg   	Vial  
2DEXAM	DexaMEthasoneé‡*åŠ›ä½³çˆ½*ç”Ÿé”	å‰ç½®è—¥		1mL    	Vial  
2DIPTY	Diphenhydramine*å°è£•*	å‰ç½®è—¥		1mL    	Vial  
2ELOXA	Eloxatin 50mg	ç„¡æ«ƒä½		10mL   	Vial  
2EMEND	Emend*é‡*	ç„¡æ«ƒä½		150mg  	Vial  
2EMPL0	Empliciti*è´ˆè—¥	ç„¡æ«ƒä½		300mg  	Vial  
2EMPLI	Empliciti*é™¢æ ¸	å†·A		300mg  	Vial  
2ENDO5	Endoxan é‡	A		500mg  	Vial  
2ENHE0	Enhertu*è´ˆè—¥	å†·B		100mg  	Vial  
2ENHER	Enhertu	å†·B		100mg  	Vial  
2EPKI0	Epkinly*ä½*è´ˆè—¥	å†·C		4mg    	Vial  
2EPKI4	Epkinly*ä½*é™¢æ ¸	ç„¡æ«ƒä½			Vial  
2ERB20	Erbitux æ–°*5mg/mL* 100mg/Vial	å†·B		20mL   	
2ERBI0	Erbitux*è´ˆè—¥*100mg/20mL/Vial	å†·B		20mL   	Vial  
2ERWI0	Erwinase"è´ˆè—¥"	å†·B		1è¬unit	Vial  
2ERWI1	Erwinase"æ–°*è‡ªè²»*è¡›å°ˆ	å†·B		1è¬unit	Vial  
2EVO0 	Evoltra*è´ˆè—¥*20mg	ç„¡æ«ƒä½		20mg   	Vial  
2EVO20	Evoltra 20mg*é™¢æ ¸	ç„¡æ«ƒä½		20mg   	Vial  
2FEBAC	Fe-Back(Fe3+:100mg/5mL)	å‰ç½®è—¥		5mL    	Vial  
2FLUDA	Fludara*é™¢æ ¸50mg é‡	B		50mg   	Vial  
2FLUOR	Fluorescite 10%	ç„¡æ«ƒä½		5mL    	Vial  
2FOLIN	Folinaé‡ 50mg#	ç„¡æ«ƒä½		5mL    	Vial  
2FOLOT	Folotyn 20mg*é™é™¢æ ¸*	ç„¡æ«ƒä½		1mL    	Vial  
2FYTOS	FytosidæŠ—ç™Œè—¥ 100mg	B		5mL    	Vial  
2GEMCI	Gemcitabine Sandoz	å†·D		200mg  	Vial  
2GLOF0	Columvi 10mg**è´ˆè—¥	å†·D			Vial  
2GR250	GRANOCYTE 250mcg	å‰ç½®è—¥		250mcg 	Vial  
2GRANT	Grantron	å‰ç½®è—¥		3mg    	Vial  
2HALAV	Halaven	C		2mL    	Vial  
2HERC0	Herceptin"è´ˆè—¥"440mg	å†·A		440mg  	Vial  
2HERC4	Herceptin 440mg/Vial	å†·A		440mg  	Vial  
2HERSC	Herceptin SC 600mg	å†°ç®±		5mL    	Vial  
2HESC0	Herceptin SC*è´ˆè—¥600mg	å†°ç®±		5mL    	Vial  
2HOLOX	Holoxan (Ifosfamide)          	C		2g     	Vial  
2HYCAM	Hycamtin	ç„¡æ«ƒä½		4mg    	Vial  
2HYCYH	HYDROCORTISONE "CYH"	å‰ç½®è—¥		100mg  	Vial  
2IMD10	IMDELLTRA*é«˜*è´ˆè—¥*è¡›å°ˆ	å†·D		10mg   	Vial  
2IMDE0	Imdelltra*ä½*è´ˆè—¥*è¡›å°ˆ	å†·D		1mg    	Vial  
2IMDE1	Imdelltra*ä½*é™¢æ ¸*è‡ªè²»	å†·D		1mg    	Vial  
2IMF10	Imfinzi 120mg*ä½åŠ‘é‡*è´ˆè—¥	ç„¡æ«ƒä½		2.4mL  	Vial  
2IMF12	Imfinzi 120mg*è‡ªè²»*ä½*é™é™¢æ ¸	ç„¡æ«ƒä½		2.4mL  	Vial  
2IMF20	IMFINZI 500mg*é«˜åŠ‘é‡*è´ˆè—¥	ç„¡æ«ƒä½		10mL   	Vial  
2IMFIN	IMFINZI 500mg*é«˜	ç„¡æ«ƒä½		10mL   	Vial  
2INTA1	Intaxel*é«˜*100mg(Paclitaxel)	A		16.7mL 	Vial  
2INTA3	Intaxel*ä½*30mg(Paclitaxel)	A		5mL    	Vial  
2IRIN5	Irino	C		5mL    	Vial  
2IXE15	Ixempra*é™é™¢æ ¸*	å†·A		15mg   	Vial  
2IXEMP	Ixempraè´ˆè—¥	å†·A		15mg   	Vial  
2JEVTA	Jevtana*è‡ªè²»*60mg*é™¢æ ¸	C		60mg   	Vial  
2KA100	Kadcyla*ä½100mg	å†·B		100mg  	Vial  
2KA160	KADCYLA*é«˜160mg	å†·B		160mg  	Vial  
2KADC0	Kadcyla"è´ˆè—¥"ä½100mg	å†·D		100mg  	Vial  
2KADC1	KADCYLA"è´ˆè—¥"é«˜160mg	å†·D		160mg  	Vial  
2KCLNA	KClå¤§*äº”ä½°mL(20mEq)in NS0.298%	å‰ç½®è—¥		500mL  	Vial  
2KE50 	Cisplatin(Kemoplat)é«˜50mg/50mL	A		50mg   	Vial  
2KEMOC	Kemocarb(Carboplatin)150mg	A		15mL   	Vial  
2KEYT0	Keytrudaè´ˆè—¥	ç„¡æ«ƒä½		50mg   	Vial  
2KEYT1	KEYTRUDA*é«˜*100mg	ç„¡æ«ƒä½		4mL    	Vial  
2KYPRO	Kyprolis 30mg*é™¢æ ¸	å†·A		30mg   	Vial  
2LEUN1	Leunase 10000KU	ç„¡æ«ƒä½		10000KU	Vial  
2LEUST	Leustatin 10mg*é™¢æ ¸	ç„¡æ«ƒä½		10mL   	Vial  
2LIPD0	Lipo-Dox*è´ˆè—¥	å†·C		10mL   	Vial  
2LIPOD	Lipo-Doxå¾®è„‚é«”	å†·B		10mL   	Vial  
2MABSC	Mabthera SCçš®ä¸‹æ³¨å°„ 1400mg	#N/A		11.7mL 	Vial  
2MABT1	Mabthera*ä½*100mg	å†·A		10mL   	Vial  
2MABT5	MABTHERA*é«˜åŠ‘é‡*500mg	å†·A		50mL   	Vial  
2MEDAS	MEDason*å‘½å¾—ç”Ÿ*	å‰ç½®è—¥		40mg   	Vial  
2MELPH	Melphadn*è¡›å°ˆ	ç„¡æ«ƒä½		50mg   	Vial  
2MEPHA	Mephal	ç„¡æ«ƒä½		50mg   	Vial  
2METEB	Methotrexat *Ebewe*é‡ 500mg	A		5mL    	Vial  
2MGSO4	MaGnesium ç´…é‚ sulfate 2g/20mL	å‰ç½®è—¥		20mL   	Vial  
2MIT20	mIToxantrone 20mg/10mL	ç„¡æ«ƒä½		10mL   	Vial  
2MITON	Mitonco(Mitomycin)	C		10mg   	Vial  
2MITOX	Mitoxantrone USP*è¡›å°ˆ*	å†·A		10mL   	Vial  
2MVAS0	Mvasi 100mg*è´ˆè—¥	ç„¡æ«ƒä½		4mL    	Vial  
2MVASI	MVASI	ç„¡æ«ƒä½		4mL    	Vial  
2MYLO5	Mylotarg*é™¢æ ¸	ç„¡æ«ƒä½		5mg    	Vial  
2NAV10	Navelbine*é‡	å†·A		1mL    	Vial  
2NIVES	Nivestim *300 mcg/0.5mL(GCSF)	å‰ç½®è—¥		0.5mL  	Vial  
2NOVAM	Novamin*é‡*	å‰ç½®è—¥		1mL    	Vial  
2OG440	Ogivri*è‡ªè²»	å†·B		440mg  	Vial  
2OGIVR	Ogivri	å†·B		440mg  	Vial  
2ONCOG	Oncoginase 10000KU*è¡›å°ˆ	å†·B		10000KU	Vial  
2ONCOT	OncoTice"é™é™¢æ ¸"è¡›ç¦éƒ¨å°ˆæ¡ˆ	ç„¡æ«ƒä½		12.5mg 	Vial  
2ONIV0	Onivydeè´ˆè—¥	å†·B		43mg   	Vial  
2ONIVY	Onivyde*å¾®è„‚é«”*	å†·B		43mg   	Vial  
2OP100	OPDIVOä¸­*100mgè´ˆè—¥*	ç„¡æ«ƒä½		10mL   	Vial  
2OP20 	Opdivo*ä½20mg*è´ˆè—¥*	ç„¡æ«ƒä½		2mL    	Vial  
2OPDI1	OPDIVO*ä¸­*100mg#	ç„¡æ«ƒä½		10mL   	Vial  
2OPDI2	Opdivo*ä½20mg*è‡ªè²»	ç„¡æ«ƒä½		2mL    	Vial  
2OPDI3	OPDIVO 120mg**é«˜åŠ‘é‡*	ç„¡æ«ƒä½		12mL   	Vial  
2OXALI	Oxalip 50mg*DC	A		10mL   	Vial  
2PAD30	Padcev	å†·C		30mg   	Vial  
2PADC0	Padcev*è´ˆè—¥	å†·C		30mg   	Vial  
2PBV  	Patent Blue V  2.5% é¡¯å½±åŠ‘	å‰ç½®è—¥		2mL    	Vial  
2PE100	Pexeda*ä½	å†·A		100mg  	Vial  
2PE500	PEXEDA*é«˜	å†·A		500mg  	Vial  
2PERJ0	Perjeta"è´ˆè—¥"420mg	å†·C		14mL   	Vial  
2PERJE	Perjeta 420mg/14mL/Vial	å†·C		14mL   	Vial  
2PHS10	Pharmorubicin 10mg Solution	å†·C		5mL    	Vial  
2PHS50	Pharmorubicin 50mg Solution	å†·C		25mL   	Vial  
2POLA0	Polivy*è´ˆè—¥	å†·B		30mg   	Vial  
2POLIV	Polivy*é™¢æ ¸	å†·B		30mg   	Vial  
2PRIMP	Primperanæ³¨å°„åŠ‘	å‰ç½®è—¥		2mL    	Vial  
2QARZI	Qarziba*é™¢æ ¸	å†·C		4.5mL  	Vial  
2RASIT	Rasitol*é‡*20mg	å‰ç½®è—¥		2mL    	Vial  
2RIND4	RINDERON*é‡	å‰ç½®è—¥		1mL    	Vial  
2RIXA1	Rixathon*ä½*100mg	å†·D		100mg  	Vial  
2RIXA5	RIXATHON*é«˜*500mg	å†·D		500mg  	Vial  
2RYBR0	Rybrevant 350mg*è´ˆè—¥	å†·C		7mL    	Vial  
2RYBRE	Rybrevant 350mg*è‡ªè²»*é™¢æ ¸	å†·D		7mL    	Vial  
2SIION	SII-Onco-BCG*é™¢æ ¸*è¡›å°ˆ	å†·C		40mg   	Vial  
2SNMC 	Stronger Neo-Minophagen C è‡ªè²»	#N/A		20mL   	Vial  
2TAXO2	Taxotere*ä½*20mg	C		1mL    	Vial  
2TAXO8	TAXOTERE*é«˜80mg*	C		4mL    	Vial  
2TE140	Tecentriq 840mgè´ˆè—¥*ä½*	ç„¡æ«ƒä½		14mL   	Vial  
2TEC14	Tecentriq 840mg*ä½*è‡ªè²»	ç„¡æ«ƒä½		14mL   	Vial  
2TECEN	TECENTRIQ é«˜åŠ‘é‡ 1200mg	ç„¡æ«ƒä½		20mL   	Vial  
2TEPAD	TEPADINA*é«˜100mgè‡ªè²»*é™¢æ ¸	ç„¡æ«ƒä½		100mg  	Vial  
2TOPO4	Hycamtin 1mg/mL	å†·A		4mL    	Vial  
2TROD0	Trodelvy*è´ˆè—¥	å†·C		180mg  	Vial  
2TRODE	Trodelvy*é™¢æ ¸	å†·D		180mg  	Vial  
2ULCER	Ulcertin*é‡*20mgå†·è—	å‰ç½®è—¥		2mL    	Vial  
2VECT0	Vectibix*è´ˆè—¥*100mg	å†·C		5mL    	Vial  
2VECTI	Vectibix	å†·C		5mL    	Vial  
2VEL35	Velcade *æ–°* 3.5mg	C		3.5mg  	Vial  
2VIDA1	Vidaza*æ–°* å¾·åœ‹å» 	B		100mg  	Vial  
2VINBL	Vinblastine 10mg/10mL*DBL*	å†·D		10mg   	Vial  
2VINCR	Vincristine 1mg/1mL*DBL*èµ«å£«ç¿	å†·C		1mL    	Vial  
2VITAC	Vitacalé‡2%CaCl2:éˆ£108.8mgé˜²æ»²	å‰ç½®è—¥		20mL   	Vial  
2VYLOY	Vyloy*è‡ªè²»*é™¢æ ¸	å‰ç½®è—¥		100mg  	Vial  
2XGEVA	Xgeva	å‰ç½®è—¥		1.7mL  	Vial  
2YOND0	Yondelis*è´ˆè—¥	å†·D		1mg    	Vial  
2YONDE	Yondelis*è‡ªè²»*é™¢æ ¸	å†·D		1mg    	Vial  
2ZAVES	Zavedos 5mg Solution	å†·D		5mL    	Vial  
2ZEPZ0	Zepzelca*è´ˆè—¥	å†·C		4mg    	Vial  
2ZEPZE	Zepzelca*é™¢æ ¸*è‡ªè²»	å†·C		4mg    	Vial  
2ZODON	Zodonic	å‰ç½®è—¥		4mg    	Vial  
2ZOLAD	Zoladex*ä½3.6mg*	å‰ç½®è—¥		3.6mg  	Vial  
2ATROP	Atropine 1mg/1mL/Amp	å‰ç½®è—¥		1mg  	Amp`;

        function InventoryApp() {
            const [isSetupMode, setIsSetupMode] = useState(true);
            const [firebaseConfig, setFirebaseConfig] = useState('');
            const [isConnected, setIsConnected] = useState(false);
            const [drugs, setDrugs] = useState([]);
            const [inventoryRecords, setInventoryRecords] = useState([]);
            const [currentMonth, setCurrentMonth] = useState(getCurrentYearMonth());
            const [selectedLocation, setSelectedLocation] = useState('');
            const [selectedDrug, setSelectedDrug] = useState(null);
            const [quantity, setQuantity] = useState('');
            const [searchTerm, setSearchTerm] = useState('');
            const [message, setMessage] = useState({ text: '', type: '' });
            const [downloadMonth, setDownloadMonth] = useState(getCurrentYearMonth());
            const [beingCounted, setBeingCounted] = useState({});
            const [onlineUsers, setOnlineUsers] = useState(0);
            const [recentActivity, setRecentActivity] = useState([]);
            const [activeTab, setActiveTab] = useState('inventory'); // æ–°å¢ï¼šç•¶å‰åˆ†é 
            
            const dbRef = useRef(null);
            const userSessionRef = useRef(null);
            const myUserId = useRef(`user_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`);

            function getCurrentYearMonth() {
                const now = new Date();
                const year = now.getFullYear();
                const month = String(now.getMonth() + 1).padStart(2, '0');
                return `${year}-${month}`;
            }

            // åˆå§‹åŒ– Firebase
            function initializeFirebase(configText) {
                try {
                    const config = JSON.parse(configText);
                    
                    // åˆå§‹åŒ– Firebase
                    if (!firebase.apps.length) {
                        firebase.initializeApp(config);
                    }
                    
                    dbRef.current = firebase.database();
                    
                    // å„²å­˜é…ç½®åˆ° localStorage
                    localStorage.setItem('firebaseConfig', configText);
                    
                    setIsSetupMode(false);
                    setIsConnected(true);
                    setupRealtimeListeners();
                    initializeDrugsData();
                    setupOnlinePresence();
                    
                    setMessage({ text: 'Firebase é€£ç·šæˆåŠŸï¼', type: 'success' });
                    setTimeout(() => setMessage({ text: '', type: '' }), 3000);
                } catch (error) {
                    setMessage({ text: `é€£ç·šå¤±æ•—: ${error.message}`, type: 'error' });
                }
            }

            // è¨­å®šç·šä¸Šç‹€æ…‹
            function setupOnlinePresence() {
                const myConnectionsRef = dbRef.current.ref(`onlineUsers/${myUserId.current}`);
                const lastOnlineRef = dbRef.current.ref(`onlineUsers/${myUserId.current}/lastOnline`);
                
                // ç•¶é€£ç·šæ™‚
                dbRef.current.ref('.info/connected').on('value', (snapshot) => {
                    if (snapshot.val() === true) {
                        myConnectionsRef.set(true);
                        myConnectionsRef.onDisconnect().remove();
                        lastOnlineRef.onDisconnect().set(firebase.database.ServerValue.TIMESTAMP);
                    }
                });
                
                // ç›£è½ç·šä¸Šäººæ•¸
                dbRef.current.ref('onlineUsers').on('value', (snapshot) => {
                    const users = snapshot.val() || {};
                    setOnlineUsers(Object.keys(users).length);
                });
                
                userSessionRef.current = myConnectionsRef;
            }

            // åˆå§‹åŒ–è—¥å“è³‡æ–™
            function initializeDrugsData() {
                dbRef.current.ref('drugs').once('value', (snapshot) => {
                    if (!snapshot.exists()) {
                        // å¦‚æœè³‡æ–™åº«æ²’æœ‰è—¥å“è³‡æ–™ï¼Œä¸Šå‚³åˆå§‹è³‡æ–™
                        parseDrugsData(initialDrugsData, true);
                    } else {
                        const drugsData = snapshot.val();
                        setDrugs(Object.values(drugsData));
                    }
                });
            }

            // è¨­å®šå³æ™‚ç›£è½
            function setupRealtimeListeners() {
                // ç›£è½è—¥å“è³‡æ–™
                dbRef.current.ref('drugs').on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        const drugsData = snapshot.val();
                        setDrugs(Object.values(drugsData));
                    }
                });

                // ç›£è½ç›¤é»è¨˜éŒ„
                dbRef.current.ref('inventoryRecords').on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        const records = snapshot.val();
                        setInventoryRecords(Object.values(records));
                    }
                });

                // ç›£è½æ­£åœ¨ç›¤é»çš„è—¥å“
                dbRef.current.ref('beingCounted').on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        setBeingCounted(snapshot.val() || {});
                    } else {
                        setBeingCounted({});
                    }
                });

                // ç›£è½æœ€è¿‘æ´»å‹•
                dbRef.current.ref('recentActivity').limitToLast(10).on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        const activities = [];
                        snapshot.forEach((child) => {
                            activities.unshift(child.val());
                        });
                        setRecentActivity(activities);
                    }
                });
            }

            // è§£æè—¥å“è³‡æ–™
            function parseDrugsData(csvText, uploadToFirebase = false) {
                Papa.parse(csvText, {
                    header: true,
                    skipEmptyLines: true,
                    complete: (results) => {
                        const parsedDrugs = results.data
                            .filter(row => row['è—¥å“åç¨±']) // éæ¿¾æ‰ç©ºè¡Œ
                            .map((row, index) => ({
                                id: `drug_${index}`,
                                code: row['è—¥ç¢¼'] || '',
                                name: row['è—¥å“åç¨±'] || '',
                                location: row['æ«ƒä½åç¨±'] || row['æ«ƒä½'] || '', // æ”¯æ´å…©ç¨®æ¬„ä½åç¨±
                                stock: row['å¯¦éš›åº«å­˜'] || '',
                                spec: row['è¦æ ¼'] || '',
                                unit: row['å–®ä½'] || ''
                            }));
                        
                        // å…ˆæ›´æ–°æœ¬åœ°ç‹€æ…‹ï¼Œè®“ä½¿ç”¨è€…ç«‹å³çœ‹åˆ°è³‡æ–™
                        setDrugs(parsedDrugs);
                        
                        // å¦‚æœéœ€è¦ï¼ŒåŒæ™‚ä¸Šå‚³åˆ° Firebase
                        if (uploadToFirebase && dbRef.current) {
                            const drugsObj = {};
                            parsedDrugs.forEach(drug => {
                                drugsObj[drug.id] = drug;
                            });
                            dbRef.current.ref('drugs').set(drugsObj)
                                .then(() => {
                                    console.log('è³‡æ–™å·²æˆåŠŸä¸Šå‚³åˆ° Firebaseï¼Œå…±', parsedDrugs.length, 'ç­†');
                                })
                                .catch((error) => {
                                    console.error('ä¸Šå‚³åˆ° Firebase å¤±æ•—:', error);
                                    setMessage({ text: 'è³‡æ–™ä¸Šå‚³å¤±æ•—: ' + error.message, type: 'error' });
                                });
                        }
                    }
                });
            }

            // ç²å–æ‰€æœ‰æ«ƒä½
            function getLocations() {
                const locations = [...new Set(drugs.map(d => d.location).filter(l => l))];
                return locations.sort();
            }

            // ç²å–æŒ‡å®šæ«ƒä½çš„è—¥å“
            function getDrugsByLocation(location) {
                if (!location) return [];
                
                const completedDrugIds = new Set(
                    inventoryRecords
                        .filter(r => r.month === currentMonth && r.location === location)
                        .map(r => r.drugId)
                );

                return drugs
                    .filter(d => d.location === location && !completedDrugIds.has(d.id))
                    .filter(d => {
                        if (!searchTerm) return true;
                        const term = searchTerm.toLowerCase();
                        return d.name.toLowerCase().includes(term) || 
                               d.code.toLowerCase().includes(term);
                    })
                    .sort((a, b) => a.name.localeCompare(b.name));
            }

            // ç²å–å·²å®Œæˆçš„ç›¤é»æ•¸é‡
            function getCompletedCount(location) {
                return inventoryRecords.filter(
                    r => r.month === currentMonth && r.location === location
                ).length;
            }

            // æ¨™è¨˜æ­£åœ¨ç›¤é»
            function markAsBeingCounted(drug) {
                if (selectedDrug?.id === drug.id) {
                    setSelectedDrug(null);
                    if (dbRef.current) {
                        dbRef.current.ref(`beingCounted/${drug.id}`).remove();
                    }
                } else {
                    setSelectedDrug(drug);
                    if (dbRef.current) {
                        dbRef.current.ref(`beingCounted/${drug.id}`).set({
                            userId: myUserId.current,
                            drugName: drug.name,
                            timestamp: firebase.database.ServerValue.TIMESTAMP
                        }).then(() => {
                            // è¨­å®š 30 ç§’å¾Œè‡ªå‹•è§£é–
                            setTimeout(() => {
                                if (dbRef.current) {
                                    dbRef.current.ref(`beingCounted/${drug.id}`).once('value', (snapshot) => {
                                        const data = snapshot.val();
                                        if (data && data.userId === myUserId.current) {
                                            dbRef.current.ref(`beingCounted/${drug.id}`).remove();
                                        }
                                    });
                                }
                            }, 30000);
                        });
                    }
                }
            }

            // å„²å­˜ç›¤é»è³‡æ–™
            function saveInventory() {
                if (!selectedDrug || !quantity) {
                    setMessage({ text: 'è«‹é¸æ“‡è—¥å“ä¸¦è¼¸å…¥æ•¸é‡', type: 'error' });
                    return;
                }

                const record = {
                    id: `record_${Date.now()}`,
                    month: currentMonth,
                    location: selectedLocation,
                    drugId: selectedDrug.id,
                    drugCode: selectedDrug.code,
                    drugName: selectedDrug.name,
                    quantity: parseInt(quantity),
                    timestamp: firebase.database.ServerValue.TIMESTAMP,
                    userId: myUserId.current
                };

                if (dbRef.current) {
                    // å„²å­˜è¨˜éŒ„
                    dbRef.current.ref(`inventoryRecords/${record.id}`).set(record);
                    
                    // ç§»é™¤æ­£åœ¨ç›¤é»æ¨™è¨˜
                    dbRef.current.ref(`beingCounted/${selectedDrug.id}`).remove();
                    
                    // æ–°å¢æ´»å‹•è¨˜éŒ„
                    dbRef.current.ref('recentActivity').push({
                        action: 'å®Œæˆç›¤é»',
                        drugName: selectedDrug.name,
                        location: selectedLocation,
                        quantity: parseInt(quantity),
                        timestamp: firebase.database.ServerValue.TIMESTAMP
                    });
                }

                setSelectedDrug(null);
                setQuantity('');
                setSearchTerm('');
                setMessage({ text: 'å„²å­˜æˆåŠŸï¼è³‡æ–™å·²åŒæ­¥åˆ°é›²ç«¯', type: 'success' });
                
                setTimeout(() => setMessage({ text: '', type: '' }), 3000);
            }

            // ä¸‹è¼‰ç›¤é»è³‡æ–™
            function downloadInventory() {
                const records = inventoryRecords.filter(r => r.month === downloadMonth);
                
                if (records.length === 0) {
                    setMessage({ text: 'è©²æœˆä»½æ²’æœ‰ç›¤é»è³‡æ–™', type: 'error' });
                    setTimeout(() => setMessage({ text: '', type: '' }), 3000);
                    return;
                }

                const csvContent = [
                    ['ç›¤é»æœˆä»½', 'æ«ƒä½', 'è—¥ç¢¼', 'è—¥å“åç¨±', 'ç›¤é»æ•¸é‡', 'ç›¤é»æ™‚é–“'].join(','),
                    ...records.map(r => [
                        r.month,
                        r.location,
                        r.drugCode,
                        r.drugName,
                        r.quantity,
                        new Date(r.timestamp).toLocaleString('zh-TW')
                    ].join(','))
                ].join('\n');

                const blob = new Blob(['\uFEFF' + csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `ç›¤é»è³‡æ–™_${downloadMonth}.csv`;
                link.click();

                setMessage({ text: 'ä¸‹è¼‰æˆåŠŸï¼', type: 'success' });
                setTimeout(() => setMessage({ text: '', type: '' }), 3000);
            }

            // ä¸Šå‚³è—¥å“æ¸…å–®
            function handleFileUpload(event) {
                const file = event.target.files[0];
                if (!file) return;

                // æª¢æŸ¥æª”æ¡ˆé¡å‹
                const fileExtension = file.name.split('.').pop().toLowerCase();
                if (!['csv', 'xlsx', 'xls'].includes(fileExtension)) {
                    setMessage({ text: 'è«‹ä¸Šå‚³ CSV æˆ– Excel æª”æ¡ˆ', type: 'error' });
                    return;
                }

                setMessage({ text: 'æ­£åœ¨è™•ç†æª”æ¡ˆ...', type: 'success' });

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        parseDrugsData(e.target.result, isConnected); // åªæœ‰åœ¨é€£ç·šæ™‚æ‰ä¸Šå‚³åˆ° Firebase
                        setMessage({ 
                            text: isConnected ? 
                                'è—¥å“æ¸…å–®æ›´æ–°æˆåŠŸï¼å·²åŒæ­¥åˆ°æ‰€æœ‰ä½¿ç”¨è€…' : 
                                'è—¥å“æ¸…å–®æ›´æ–°æˆåŠŸï¼ï¼ˆé›¢ç·šæ¨¡å¼ï¼ŒæœªåŒæ­¥åˆ°é›²ç«¯ï¼‰', 
                            type: 'success' 
                        });
                        setTimeout(() => setMessage({ text: '', type: '' }), 5000);
                        
                        // æ¸…ç©ºæ–‡ä»¶é¸æ“‡å™¨ï¼Œå…è¨±é‡è¤‡ä¸Šå‚³åŒä¸€å€‹æª”æ¡ˆ
                        event.target.value = '';
                    } catch (error) {
                        setMessage({ text: 'æª”æ¡ˆè™•ç†å¤±æ•—: ' + error.message, type: 'error' });
                    }
                };
                reader.onerror = () => {
                    setMessage({ text: 'æª”æ¡ˆè®€å–å¤±æ•—', type: 'error' });
                };
                reader.readAsText(file);
            }

            // æª¢æŸ¥æ˜¯å¦æœ‰å„²å­˜çš„é…ç½®
            useEffect(() => {
                const savedConfig = localStorage.getItem('firebaseConfig');
                if (savedConfig) {
                    initializeFirebase(savedConfig);
                } else {
                    parseDrugsData(initialDrugsData);
                }

                // æ¸…ç†å‡½æ•¸
                return () => {
                    if (userSessionRef.current) {
                        userSessionRef.current.remove();
                    }
                };
            }, []);

            const stats = {
                totalDrugs: drugs.length,
                completedThisMonth: inventoryRecords.filter(r => r.month === currentMonth).length,
                currentLocationTotal: selectedLocation ? drugs.filter(d => d.location === selectedLocation).length : 0
            };

            // è¨­å®šæ¨¡å¼ç•«é¢
            if (isSetupMode) {
                return (
                    <div className="setup-modal">
                        <div className="setup-content">
                            <h2>ğŸ”§ Firebase è¨­å®š</h2>
                            <p>è«‹è²¼ä¸Šæ‚¨çš„ Firebase é…ç½® JSONï¼ˆè«‹åƒè€ƒè¨­å®šæ•™å­¸æ–‡ä»¶ï¼‰</p>
                            <textarea
                                value={firebaseConfig}
                                onChange={(e) => setFirebaseConfig(e.target.value)}
                                placeholder='è«‹åœ¨æ­¤è²¼ä¸Šæ‚¨çš„ Firebase é…ç½® JSON'
                                style={{ resize: 'vertical' }}
                            ></textarea>
                            <div style={{ marginTop: '20px', display: 'flex', gap: '10px' }}>
                                <button onClick={() => initializeFirebase(firebaseConfig)}>
                                    âœ… é€£ç·š
                                </button>
                                <button className="secondary" onClick={() => {
                                    setIsSetupMode(false);
                                    parseDrugsData(initialDrugsData);
                                }}>
                                    ğŸš« é›¢ç·šæ¨¡å¼
                                </button>
                            </div>
                            {message.text && (
                                <div className={message.type === 'success' ? 'success-message' : 'error-message'} style={{ marginTop: '15px' }}>
                                    {message.text}
                                </div>
                            )}
                            <div className="info-box" style={{ marginTop: '20px' }}>
                                <strong>æç¤ºï¼š</strong>å¦‚æœæ‚¨é‚„æ²’æœ‰ Firebase é…ç½®ï¼Œè«‹æŸ¥çœ‹ã€ŒFirebaseè¨­å®šæ•™å­¸.txtã€æ–‡ä»¶
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="container">
                    {/* é€£ç·šç‹€æ…‹ */}
                    <div className="connection-status">
                        <div className={`status-dot ${isConnected ? 'connected' : 'disconnected'}`}></div>
                        <span>{isConnected ? `ğŸŸ¢ å·²é€£ç·š (${onlineUsers} äººåœ¨ç·š)` : 'ğŸ”´ é›¢ç·šæ¨¡å¼'}</span>
                    </div>

                    <h1>ğŸ“‹ ä½é™¢ç›¤é»ç³»çµ±</h1>

                    {/* è¨Šæ¯é¡¯ç¤º */}
                    {message.text && (
                        <div className={message.type === 'success' ? 'success-message' : message.type === 'warning' ? 'warning-message' : 'error-message'}>
                            {message.text}
                        </div>
                    )}

                    {/* çµ±è¨ˆå¡ç‰‡ */}
                    <div className="stats">
                        <div className="stat-card">
                            <div className="stat-number">{stats.totalDrugs}</div>
                            <div className="stat-label">ç¸½è—¥å“æ•¸</div>
                        </div>
                        <div className="stat-card">
                            <div className="stat-number">{stats.completedThisMonth}</div>
                            <div className="stat-label">æœ¬æœˆå·²ç›¤é»</div>
                        </div>
                        {selectedLocation && (
                            <div className="stat-card">
                                <div className="stat-number">
                                    {getCompletedCount(selectedLocation)}/{stats.currentLocationTotal}
                                </div>
                                <div className="stat-label">ç•¶å‰æ«ƒä½é€²åº¦</div>
                            </div>
                        )}
                        {isConnected && (
                            <div className="stat-card">
                                <div className="stat-number">{onlineUsers}</div>
                                <div className="stat-label">ç·šä¸Šäººæ•¸</div>
                            </div>
                        )}
                    </div>

                    {/* æœ€è¿‘æ´»å‹• */}
                    {isConnected && recentActivity.length > 0 && (
                        <div className="section">
                            <h2 className="section-title">ğŸ“Š æœ€è¿‘æ´»å‹•</h2>
                            <div className="recent-activity">
                                {recentActivity.map((activity, index) => (
                                    <div key={index} className="activity-item">
                                        <div>
                                            <strong>{activity.action}ï¼š</strong>
                                            {activity.drugName} ({activity.location}) - æ•¸é‡: {activity.quantity}
                                        </div>
                                        <div className="activity-time">
                                            {new Date(activity.timestamp).toLocaleString('zh-TW')}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* åˆ†é å®¹å™¨ */}
                    <div className="tabs-container">
                        {/* åˆ†é æ¨™ç±¤ */}
                        <div className="tabs-header">
                            <button 
                                className={`tab-button ${activeTab === 'inventory' ? 'active' : ''}`}
                                onClick={() => setActiveTab('inventory')}
                            >
                                <span className="tab-icon">ğŸ“</span>
                                ç›¤é»å€
                            </button>
                            <button 
                                className={`tab-button ${activeTab === 'download' ? 'active' : ''}`}
                                onClick={() => setActiveTab('download')}
                            >
                                <span className="tab-icon">ğŸ“¥</span>
                                ä¸‹è¼‰å€
                            </button>
                            <button 
                                className={`tab-button ${activeTab === 'upload' ? 'active' : ''}`}
                                onClick={() => setActiveTab('upload')}
                            >
                                <span className="tab-icon">ğŸ“¤</span>
                                ä¸Šå‚³å€
                            </button>
                        </div>

                        {/* åˆ†é å…§å®¹ */}
                        <div className="tab-content">
                            {/* ç›¤é»å€å…§å®¹ */}
                            {activeTab === 'inventory' && (
                                <div>

                        <div className="form-group">
                            <label>æ­¥é©Ÿ 1ï¼šé¸æ“‡ç›¤é»æœˆä»½</label>
                            <input
                                type="month"
                                value={currentMonth}
                                onChange={(e) => {
                                    setCurrentMonth(e.target.value);
                                    setSelectedLocation('');
                                    setSelectedDrug(null);
                                }}
                            />
                        </div>

                        <div className="form-group">
                            <label>æ­¥é©Ÿ 2ï¼šé¸æ“‡ç›¤é»ä½ç½®</label>
                            <select
                                value={selectedLocation}
                                onChange={(e) => {
                                    setSelectedLocation(e.target.value);
                                    setSelectedDrug(null);
                                    setSearchTerm('');
                                }}
                            >
                                <option value="">è«‹é¸æ“‡æ«ƒä½</option>
                                {getLocations().map(loc => (
                                    <option key={loc} value={loc}>{loc}</option>
                                ))}
                            </select>
                        </div>

                        {selectedLocation && (
                            <div className="current-selection">
                                <strong>ç›®å‰ç›¤é»ä½ç½®ï¼š</strong> {selectedLocation}
                                <span style={{ marginLeft: '20px' }}>
                                    <strong>å·²å®Œæˆï¼š</strong> {getCompletedCount(selectedLocation)}/{stats.currentLocationTotal}
                                </span>
                            </div>
                        )}

                        {selectedLocation && (
                            <div className="form-group">
                                <label>æ­¥é©Ÿ 3ï¼šé¸æ“‡è¦ç›¤é»çš„è—¥å“</label>
                                
                                <div className="search-box">
                                    <input
                                        type="text"
                                        placeholder="æœå°‹è—¥å“åç¨±æˆ–è—¥ç¢¼..."
                                        value={searchTerm}
                                        onChange={(e) => setSearchTerm(e.target.value)}
                                    />
                                    <span className="search-icon">ğŸ”</span>
                                </div>

                                <div className="drug-list">
                                    {getDrugsByLocation(selectedLocation).length === 0 ? (
                                        <div className="info-box">
                                            {searchTerm ? 'æ²’æœ‰ç¬¦åˆæœå°‹æ¢ä»¶çš„è—¥å“' : 'æ­¤æ«ƒä½çš„æ‰€æœ‰è—¥å“éƒ½å·²ç›¤é»å®Œæˆï¼'}
                                        </div>
                                    ) : (
                                        getDrugsByLocation(selectedLocation).map(drug => {
                                            const isBeingCounted = beingCounted[drug.id];
                                            const isMySelection = selectedDrug?.id === drug.id;
                                            const isOtherCounting = isBeingCounted && !isMySelection;
                                            
                                            return (
                                                <div
                                                    key={drug.id}
                                                    className={`drug-item ${isMySelection ? 'selected' : ''} ${isOtherCounting ? 'being-counted' : ''}`}
                                                    onClick={() => !isOtherCounting && markAsBeingCounted(drug)}
                                                    style={isOtherCounting ? { cursor: 'not-allowed', opacity: 0.6 } : {}}
                                                >
                                                    {isOtherCounting && <span className="counting-badge">æœ‰äººæ­£åœ¨ç›¤é»</span>}
                                                    <strong>{drug.name}</strong>
                                                    <div style={{ fontSize: '0.9em', color: isMySelection ? 'white' : '#666', marginTop: '5px' }}>
                                                        è—¥ç¢¼: {drug.code} | è¦æ ¼: {drug.spec} | å–®ä½: {drug.unit}
                                                    </div>
                                                </div>
                                            );
                                        })
                                    )}
                                </div>
                            </div>
                        )}

                        {selectedDrug && (
                            <div className="form-group">
                                <label>æ­¥é©Ÿ 4ï¼šè¼¸å…¥ç›¤é»æ•¸é‡</label>
                                <div className="info-box">
                                    <strong>å·²é¸æ“‡ï¼š</strong> {selectedDrug.name} ({selectedDrug.code})
                                </div>
                                <input
                                    type="number"
                                    placeholder="è«‹è¼¸å…¥ç›¤é»æ•¸é‡"
                                    value={quantity}
                                    onChange={(e) => setQuantity(e.target.value)}
                                    min="0"
                                />
                                <div style={{ marginTop: '15px' }}>
                                    <button onClick={saveInventory}>ğŸ’¾ å„²å­˜ç›¤é»è³‡æ–™</button>
                                </div>
                            </div>
                        )}
                                </div>
                            )}

                            {/* ä¸‹è¼‰å€å…§å®¹ */}
                            {activeTab === 'download' && (
                                <div>
                        <div className="form-group">
                            <label>é¸æ“‡è¦ä¸‹è¼‰çš„å¹´æœˆ</label>
                            <input
                                type="month"
                                value={downloadMonth}
                                onChange={(e) => setDownloadMonth(e.target.value)}
                            />
                        </div>
                        <button onClick={downloadInventory}>â¬‡ï¸ ä¸‹è¼‰ç›¤é»è³‡æ–™</button>
                        
                        <div className="info-box" style={{ marginTop: '15px' }}>
                            è©²æœˆä»½å…±æœ‰ <strong>{inventoryRecords.filter(r => r.month === downloadMonth).length}</strong> ç­†ç›¤é»è¨˜éŒ„
                        </div>
                                </div>
                            )}

                            {/* ä¸Šå‚³å€å…§å®¹ */}
                            {activeTab === 'upload' && isConnected && (
                                <div>
                            <div className="warning-message">
                                âš ï¸ ä¸Šå‚³æ–°çš„è—¥å“æ¸…å–®æœƒè¦†è“‹ç¾æœ‰è³‡æ–™ï¼Œä¸¦åŒæ­¥åˆ°æ‰€æœ‰ä½¿ç”¨è€…
                            </div>
                            <div 
                                className="upload-area"
                                onClick={() => document.getElementById('fileInput').click()}
                            >
                                <p style={{ fontSize: '2em', marginBottom: '10px' }}>ğŸ“„</p>
                                <p>é»æ“Šæ­¤è™•ä¸Šå‚³è—¥å“æ¸…å–®æª”æ¡ˆ</p>
                                <p style={{ fontSize: '0.9em', color: '#666', marginTop: '10px' }}>
                                    æ”¯æ´ CSV æ ¼å¼ï¼ˆé ˆåŒ…å«ï¼šè—¥ç¢¼ã€è—¥å“åç¨±ã€æ«ƒä½ã€è¦æ ¼ã€å–®ä½æ¬„ä½ï¼‰
                                </p>
                            </div>
                            <input
                                id="fileInput"
                                type="file"
                                accept=".csv,.txt"
                                onChange={handleFileUpload}
                            />
                            
                            <div className="info-box" style={{ marginTop: '15px' }}>
                                ç›®å‰ç³»çµ±ä¸­å…±æœ‰ <strong>{drugs.length}</strong> ç­†è—¥å“è³‡æ–™
                            </div>
                                </div>
                            )}

                            {/* ä¸Šå‚³å€ - é›¢ç·šæ¨¡å¼æç¤º */}
                            {activeTab === 'upload' && !isConnected && (
                                <div>
                                    <div className="warning-message">
                                        âš ï¸ ä¸Šå‚³åŠŸèƒ½éœ€è¦é€£ç·šæ¨¡å¼æ‰èƒ½ä½¿ç”¨ï¼Œä»¥ç¢ºä¿è³‡æ–™åŒæ­¥åˆ°æ‰€æœ‰ä½¿ç”¨è€…
                                    </div>
                                    <div className="info-box" style={{ marginTop: '15px' }}>
                                        è«‹å…ˆå®Œæˆ Firebase é€£ç·šè¨­å®šï¼Œæˆ–ä½¿ç”¨é›¢ç·šæ¨¡å¼é€²è¡Œç›¤é»
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<InventoryApp />, document.getElementById('root'));
    </script>
</body>
</html>
